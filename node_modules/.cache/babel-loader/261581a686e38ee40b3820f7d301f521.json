{"remainingRequest":"/Users/howie/Documents/nlp_web/node_modules/babel-loader/lib/index.js!/Users/howie/Documents/nlp_web/src/permission.js","dependencies":[{"path":"/Users/howie/Documents/nlp_web/src/permission.js","mtime":1585142321714},{"path":"/Users/howie/Documents/nlp_web/node_modules/cache-loader/dist/cjs.js","mtime":1571922489860},{"path":"/Users/howie/Documents/nlp_web/node_modules/babel-loader/lib/index.js","mtime":1571922477277}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuaW5kZXgtb2YiOwppbXBvcnQgcm91dGVyIGZyb20gJy4vcm91dGVyJzsKaW1wb3J0IHN0b3JlIGZyb20gJy4vc3RvcmUnOwppbXBvcnQgS2V5Y2xvYWsgZnJvbSAna2V5Y2xvYWstanMnOwppbXBvcnQgand0RGVjb2RlIGZyb20gJ2p3dC1kZWNvZGUnOwpyb3V0ZXIuYmVmb3JlRWFjaChmdW5jdGlvbiAodG8sIGZyb20sIG5leHQpIHsKICB2YXIgdG9rZW4gPSBzZXNzaW9uU3RvcmFnZS5nZXRJdGVtKCd0b2tlbicpOyAvLyDojrflj5bnlKjmiLfnmbvlvZV0b2tlbgoKICB2YXIgdXNlck5hbWUgPSBzZXNzaW9uU3RvcmFnZS5nZXRJdGVtKCd1c2VyTmFtZScpOyAvLyDojrflj5bnlKjmiLfnmbvlvZV0b2tlbgoKICBpZiAodG9rZW4gPT09IG51bGwgfHwgdG9rZW4gPT09ICcnIHx8IHVzZXJOYW1lID09PSBudWxsIHx8IHVzZXJOYW1lID09PSAnJykgewogICAgdmFyIGtleWNsb2FrID0gbnVsbDsKICAgIGtleWNsb2FrID0gS2V5Y2xvYWsoewogICAgICB1cmw6ICdodHRwOi8vdS54bG1lZGlhd2F0Y2guY29tL2F1dGgnLAogICAgICByZWFsbTogJ3hscGxhdGZvcm0nLAogICAgICBjbGllbnRJZDogc3RvcmUuc3RhdGUuY2xpZW50SWQKICAgIH0pOwogICAga2V5Y2xvYWsuaW5pdCh7CiAgICAgIG9uTG9hZDogJ2xvZ2luLXJlcXVpcmVkJwogICAgfSkuc3VjY2VzcyhmdW5jdGlvbiAoYXV0aGVudGljYXRlZCkgewogICAgICBpZiAoIWF1dGhlbnRpY2F0ZWQpIHsKICAgICAgICBhbGVydCgn55m76ZmG5aSx6LSlJyk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAga2V5Y2xvYWsubG9hZFVzZXJQcm9maWxlKCkuc3VjY2VzcyhmdW5jdGlvbiAoZGF0YSkgewogICAgICAgICAgc2Vzc2lvblN0b3JhZ2Uuc2V0SXRlbSgndG9rZW4nLCBrZXljbG9hay50b2tlbik7CiAgICAgICAgICBzZXNzaW9uU3RvcmFnZS5zZXRJdGVtKCd1c2VyTmFtZScsIGRhdGEuZmlyc3ROYW1lKTsKICAgICAgICAgIG5leHQoewogICAgICAgICAgICBwYXRoOiAnL3BhcnRzQW5hbHlzaXMnCiAgICAgICAgICB9KTsKICAgICAgICB9KTsKCiAgICAgICAgaWYgKHRva2VuID09PSBudWxsIHx8IHRva2VuID09PSAnJyB8fCB1c2VyTmFtZSA9PT0gbnVsbCB8fCB1c2VyTmFtZSA9PT0gJycpIHsKICAgICAgICAgIHNlc3Npb25TdG9yYWdlLmNsZWFyKCk7CiAgICAgICAgICBrZXljbG9hay5sb2dvdXQoKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0pLmVycm9yKGZ1bmN0aW9uICgpIHsKICAgICAgYWxlcnQoJ+iupOivgeS4reW/g+W8guW4uCcpOwogICAgfSk7CiAgfSBlbHNlIHsKICAgIGlmICh0by5wYXRoLmluZGV4T2YoJyZzdGF0ZT0nKSAhPT0gLTEpIHsKICAgICAgbmV4dCh7CiAgICAgICAgcGF0aDogJy8nCiAgICAgIH0pOwogICAgfSBlbHNlIHsKICAgICAgbmV4dCgpOwogICAgfQogIH0KfSk7"},{"version":3,"sources":["/Users/howie/Documents/nlp_web/src/permission.js"],"names":["router","store","Keycloak","jwtDecode","beforeEach","to","from","next","token","sessionStorage","getItem","userName","keycloak","url","realm","clientId","state","init","onLoad","success","authenticated","alert","loadUserProfile","data","setItem","firstName","path","clear","logout","error","indexOf"],"mappings":";AAAA,OAAOA,MAAP,MAAmB,UAAnB;AACA,OAAOC,KAAP,MAAkB,SAAlB;AACA,OAAOC,QAAP,MAAqB,aAArB;AACA,OAAOC,SAAP,MAAsB,YAAtB;AAGAH,MAAM,CAACI,UAAP,CAAkB,UAACC,EAAD,EAAKC,IAAL,EAAWC,IAAX,EAAoB;AAClC,MAAIC,KAAK,GAAGC,cAAc,CAACC,OAAf,CAAuB,OAAvB,CAAZ,CADkC,CACU;;AAC5C,MAAIC,QAAQ,GAAGF,cAAc,CAACC,OAAf,CAAuB,UAAvB,CAAf,CAFkC,CAEgB;;AAClD,MAAIF,KAAK,KAAK,IAAV,IAAkBA,KAAK,KAAK,EAA5B,IAAkCG,QAAQ,KAAK,IAA/C,IAAuDA,QAAQ,KAAK,EAAxE,EAA4E;AACxE,QAAIC,QAAQ,GAAG,IAAf;AACAA,IAAAA,QAAQ,GAAGV,QAAQ,CAAC;AAChBW,MAAAA,GAAG,EAAE,gCADW;AAEhBC,MAAAA,KAAK,EAAE,YAFS;AAGhBC,MAAAA,QAAQ,EAAEd,KAAK,CAACe,KAAN,CAAYD;AAHN,KAAD,CAAnB;AAKAH,IAAAA,QAAQ,CAACK,IAAT,CAAc;AAACC,MAAAA,MAAM,EAAE;AAAT,KAAd,EAA0CC,OAA1C,CAAkD,UAAUC,aAAV,EAAyB;AACvE,UAAI,CAACA,aAAL,EAAoB;AAChBC,QAAAA,KAAK,CAAC,MAAD,CAAL;AACH,OAFD,MAEO;AACHT,QAAAA,QAAQ,CAACU,eAAT,GAA2BH,OAA3B,CAAmC,UAAAI,IAAI,EAAI;AACvCd,UAAAA,cAAc,CAACe,OAAf,CAAuB,OAAvB,EAAgCZ,QAAQ,CAACJ,KAAzC;AACAC,UAAAA,cAAc,CAACe,OAAf,CAAuB,UAAvB,EAAmCD,IAAI,CAACE,SAAxC;AACAlB,UAAAA,IAAI,CAAC;AAACmB,YAAAA,IAAI,EAAE;AAAP,WAAD,CAAJ;AACH,SAJD;;AAKA,YAAIlB,KAAK,KAAK,IAAV,IAAkBA,KAAK,KAAK,EAA5B,IAAkCG,QAAQ,KAAK,IAA/C,IAAuDA,QAAQ,KAAK,EAAxE,EAA4E;AACxEF,UAAAA,cAAc,CAACkB,KAAf;AACAf,UAAAA,QAAQ,CAACgB,MAAT;AACH;AACJ;AACJ,KAdD,EAcGC,KAdH,CAcS,YAAY;AACjBR,MAAAA,KAAK,CAAC,QAAD,CAAL;AACH,KAhBD;AAiBH,GAxBD,MAwBO;AACH,QAAIhB,EAAE,CAACqB,IAAH,CAAQI,OAAR,CAAgB,SAAhB,MAA+B,CAAC,CAApC,EAAuC;AACnCvB,MAAAA,IAAI,CAAC;AAACmB,QAAAA,IAAI,EAAE;AAAP,OAAD,CAAJ;AACH,KAFD,MAEO;AACHnB,MAAAA,IAAI;AACP;AACJ;AACJ,CAlCD","sourcesContent":["import router from './router'\nimport store from './store'\nimport Keycloak from 'keycloak-js'\nimport jwtDecode from 'jwt-decode'\n\n\nrouter.beforeEach((to, from, next) => {\n    let token = sessionStorage.getItem('token') // 获取用户登录token\n    let userName = sessionStorage.getItem('userName') // 获取用户登录token\n    if (token === null || token === '' || userName === null || userName === '') {\n        let keycloak = null;\n        keycloak = Keycloak({\n            url: 'http://u.xlmediawatch.com/auth',\n            realm: 'xlplatform',\n            clientId: store.state.clientId\n        });\n        keycloak.init({onLoad: 'login-required'}).success(function (authenticated) {\n            if (!authenticated) {\n                alert('登陆失败')\n            } else {\n                keycloak.loadUserProfile().success(data => {\n                    sessionStorage.setItem('token', keycloak.token)\n                    sessionStorage.setItem('userName', data.firstName)\n                    next({path: '/partsAnalysis'})\n                })\n                if (token === null || token === '' || userName === null || userName === '') {\n                    sessionStorage.clear();\n                    keycloak.logout();\n                }\n            }\n        }).error(function () {\n            alert('认证中心异常');\n        });\n    } else {\n        if (to.path.indexOf('&state=') !== -1) {\n            next({path: '/'})\n        } else {\n            next()\n        }\n    }\n})\n\n\n"]}]}